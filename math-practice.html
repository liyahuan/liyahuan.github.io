<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¼å°è¡”æ¥å£ç®—ç»ƒä¹ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        accent: '#f97316',
                        dark: '#1e293b',
                        light: '#f8fafc',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        happy: '#8b5cf6',
                        fun: '#ec4899',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        comic: ['Comic Sans MS', 'cursive', 'sans-serif'],
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s infinite',
                    },
                    keyframes: {
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        }
                    }
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-all-300 {
                transition: all 300ms ease-in-out;
            }
            .btn-hover {
                @apply hover:scale-105 transition-all duration-300 hover:shadow-lg;
            }
            .card-hover {
                @apply hover:shadow-xl transition-all duration-300 hover:-translate-y-1;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen font-comic text-dark">
    <!-- å¯¼èˆªæ  -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-primary rounded-full flex items-center justify-center">
                    <span class="text-white font-bold text-xl sm:text-2xl">ğŸ§®</span>
                </div>
                <h1 class="text-lg sm:text-2xl font-bold text-dark">è¶£å‘³å£ç®—ç»ƒä¹ </h1>
            </div>
            <div class="flex items-center gap-2 sm:gap-4">
                <button id="soundToggle" class="w-8 h-8 sm:w-10 sm:h-10 bg-light rounded-full flex items-center justify-center btn-hover">
                    <span class="text-base sm:text-xl">ğŸ”Š</span>
                </button>
                <button id="helpBtn" class="w-8 h-8 sm:w-10 sm:h-10 bg-light rounded-full flex items-center justify-center btn-hover">
                    <span class="text-base sm:text-xl">â“</span>
                </button>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8 pb-32">
        <!-- æ¬¢è¿åŒº -->
        <section id="welcomeSection" class="bg-white rounded-2xl shadow-lg p-6 sm:p-8 mb-8 text-center">
            <div class="mb-4 sm:mb-6">
                <span class="text-4xl sm:text-6xl">ğŸ‰</span>
            </div>
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-primary">æ¬¢è¿æ¥åˆ°è¶£å‘³å£ç®—ç»ƒä¹ ï¼</h2>
            <p class="text-base sm:text-lg text-secondary mb-6 sm:mb-8">
                å°æœ‹å‹ä»¬ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å¿«ä¹å­¦ä¹ æ•°å­¦å§ï¼
            </p>
            <div class="flex flex-col sm:flex-row flex-wrap justify-center gap-4">
                <button id="startPractice" class="bg-primary text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl text-base sm:text-xl font-bold btn-hover">
                    å¼€å§‹ç»ƒä¹ 
                </button>
                <button id="viewAchievements" class="bg-accent text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl text-base sm:text-xl font-bold btn-hover">
                    æŸ¥çœ‹æˆå°±
                </button>
            </div>
        </section>

        <!-- ç»ƒä¹ è®¾ç½®åŒº -->
        <section id="settingsSection" class="bg-white rounded-2xl shadow-lg p-6 sm:p-8 mb-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <button id="backToWelcomeFromSettings" class="bg-secondary text-white px-3 sm:px-4 py-1 sm:py-2 rounded-lg font-bold btn-hover text-sm sm:text-base">
                    <span class="mr-1 sm:mr-2">ğŸ </span> è¿”å›ä¸»é¡µ
                </button>
                <h2 class="text-xl sm:text-2xl font-bold text-center">ç»ƒä¹ è®¾ç½®</h2>
                <div class="w-16 sm:w-24"></div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8">
                <!-- ç»ƒä¹ ç±»å‹ -->
                <div>
                    <h3 class="text-base sm:text-lg font-bold mb-4 text-secondary">ç»ƒä¹ ç±»å‹</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <button class="practice-type-btn bg-blue-100 text-primary py-3 rounded-xl font-bold text-center card-hover" data-type="addition">
                            <span class="text-xl sm:text-2xl mb-2 block">â•</span>
                            åŠ æ³•
                        </button>
                        <button class="practice-type-btn bg-green-100 text-success py-3 rounded-xl font-bold text-center card-hover" data-type="subtraction">
                            <span class="text-xl sm:text-2xl mb-2 block">â–</span>
                            å‡æ³•
                        </button>
                    </div>
                </div>
                
                <!-- éš¾åº¦çº§åˆ« -->
                <div>
                    <h3 class="text-base sm:text-lg font-bold mb-4 text-secondary">éš¾åº¦çº§åˆ«</h3>
                    <div class="space-y-4">
                        <button class="difficulty-btn bg-light border-2 border-gray-200 py-3 rounded-xl font-bold text-center card-hover" data-level="easy">
                            <span class="text-base sm:text-xl mb-1 block">ğŸ£</span>
                            åˆçº§ (5ä»¥å†…)
                        </button>
                        <button class="difficulty-btn bg-light border-2 border-gray-200 py-3 rounded-xl font-bold text-center card-hover" data-level="medium">
                            <span class="text-base sm:text-xl mb-1 block">ğŸ¥</span>
                            ä¸­çº§ (10ä»¥å†…)
                        </button>
                        <button class="difficulty-btn bg-light border-2 border-gray-200 py-3 rounded-xl font-bold text-center card-hover" data-level="hard">
                            <span class="text-base sm:text-xl mb-1 block">ğŸ”</span>
                            é«˜çº§ (20ä»¥å†…)
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 sm:mt-8 text-center">
                <button id="confirmSettings" class="bg-primary text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl text-base sm:text-xl font-bold btn-hover">
                    ç¡®è®¤è®¾ç½®
                </button>
            </div>
        </section>

        <!-- ç»ƒä¹ åŒº -->
        <section id="practiceSection" class="bg-white rounded-2xl shadow-lg p-8 sm:p-12 mb-12 min-h-[70vh] lg:min-h-[85vh] hidden">
            <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
            <div class="flex justify-between items-center mb-8 sm:mb-12">
                <button id="backToWelcomeFromPractice" class="bg-secondary text-white px-3 sm:px-4 py-1 sm:py-2 rounded-lg font-bold btn-hover text-sm sm:text-base">
                    <span class="mr-1 sm:mr-2">ğŸ </span> è¿”å›ä¸»é¡µ
                </button>
                <div>
                    <span class="font-bold text-sm sm:text-base">è¿›åº¦: </span>
                    <span id="progressText" class="text-sm sm:text-base">0/10</span>
                </div>
            </div>
            
            <!-- è¿›åº¦æ¡ -->
            <div class="mb-8 sm:mb-12">
                <div class="w-full bg-gray-200 rounded-full h-4">
                    <div id="progressBar" class="bg-primary h-4 rounded-full" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- é¢˜ç›®åŒº -->
            <div class="mb-12 sm:mb-16 text-center">
                <div id="visualization" class="flex items-center justify-center gap-4 sm:gap-8 mb-8 sm:mb-12">
                    <div class="text-3xl sm:text-5xl font-bold" id="num1">8</div>
                    <div class="text-3xl sm:text-5xl font-bold" id="operator">+</div>
                    <div class="text-3xl sm:text-5xl font-bold" id="num2">5</div>
                    <div class="text-3xl sm:text-5xl font-bold">=</div>
                    <div class="w-24 sm:w-28 h-16 sm:h-20 border-2 border-primary rounded-xl flex items-center justify-center" id="answerBox">
                        <span id="answer" class="text-2xl sm:text-3xl">?</span>
                    </div>
                </div>
                
                <!-- è®¡ç®—è¿‡ç¨‹å¯è§†åŒ– -->
                <div id="calculationVisualization" class="bg-blue-50 rounded-xl p-6 sm:p-8 mb-8 sm:mb-12 hidden">
                    <h3 class="text-lg sm:text-xl font-bold mb-4 sm:mb-6">è®¡ç®—è¿‡ç¨‹</h3>
                    <div id="visualizationSteps" class="space-y-4 sm:space-y-6">
                        <!-- è®¡ç®—æ­¥éª¤å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- è¾“å…¥åŒº -->
            <div class="mb-8 sm:mb-12">
                <h3 class="text-lg sm:text-xl font-bold mb-4 sm:mb-6 text-center">è¯·è¾“å…¥ç­”æ¡ˆ</h3>
                <div class="grid grid-cols-3 gap-4 sm:gap-6 max-w-md mx-auto">
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">1</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">2</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">3</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">4</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">5</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">6</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">7</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">8</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">9</button>
                    <button class="bg-primary text-white py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center btn-hover" id="clearBtn">æ¸…é™¤</button>
                    <button class="number-btn bg-light border-2 border-gray-200 py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center card-hover">0</button>
                    <button class="bg-success text-white py-4 sm:py-6 rounded-xl font-bold text-xl sm:text-3xl text-center btn-hover" id="submitBtn">æäº¤</button>
                </div>
            </div>
            
            <!-- æ§åˆ¶æŒ‰é’® -->
            <div class="flex flex-wrap justify-center gap-4 sm:gap-6">
                <button id="listenQuestion" class="bg-accent text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold btn-hover text-base sm:text-lg">
                    <span class="mr-2 sm:mr-3">ğŸ”Š</span> å¬é¢˜ç›®
                </button>
                <button id="showHint" class="bg-warning text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold btn-hover text-base sm:text-lg">
                    <span class="mr-2 sm:mr-3">ğŸ’¡</span> æç¤º
                </button>
                <button id="skipQuestion" class="bg-secondary text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold btn-hover text-base sm:text-lg">
                    <span class="mr-2 sm:mr-3">â­ï¸</span> è·³è¿‡
                </button>
            </div>
        </section>

        <!-- ç»“æœåŒº -->
        <section id="resultSection" class="bg-white rounded-2xl shadow-lg p-6 sm:p-8 mb-8 hidden">
            <div class="text-center mb-6 sm:mb-8">
                <div id="resultEmoji" class="text-6xl sm:text-8xl mb-3 sm:mb-4">ğŸ‰</div>
                <h2 class="text-2xl sm:text-3xl font-bold mb-3 sm:mb-4" id="resultTitle">ç»ƒä¹ å®Œæˆï¼</h2>
                <p class="text-base sm:text-xl mb-4 sm:mb-6" id="resultMessage">ä½ å¤ªæ£’äº†ï¼</p>
                
                <div class="flex justify-center gap-4 sm:gap-8 mb-6 sm:mb-8">
                    <div class="text-center">
                        <div class="text-3xl sm:text-4xl font-bold text-primary mb-2" id="correctCount">8</div>
                        <div class="text-secondary text-sm sm:text-base">æ­£ç¡®é¢˜æ•°</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl sm:text-4xl font-bold text-accent mb-2" id="accuracy">80%</div>
                        <div class="text-secondary text-sm sm:text-base">æ­£ç¡®ç‡</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4 max-w-2xl mx-auto">
                    <button id="retryBtn" class="bg-primary text-white px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-bold btn-hover text-sm sm:text-base">
                        å†è¯•ä¸€æ¬¡
                    </button>
                    <button id="changeSettingsBtn" class="bg-accent text-white px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-bold btn-hover text-sm sm:text-base">
                        æ›´æ”¹è®¾ç½®
                    </button>
                    <button id="backToWelcomeBtn" class="bg-secondary text-white px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-bold btn-hover text-sm sm:text-base">
                        è¿”å›é¦–é¡µ
                    </button>
                </div>
            </div>
        </section>

        <!-- æˆå°±åŒº -->
        <section id="achievementsSection" class="bg-white rounded-2xl shadow-lg p-6 sm:p-8 mb-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <button id="backFromAchievements" class="bg-secondary text-white px-3 sm:px-4 py-1 sm:py-2 rounded-lg font-bold btn-hover text-sm sm:text-base">
                    <span class="mr-1 sm:mr-2">ğŸ </span> è¿”å›ä¸»é¡µ
                </button>
                <h2 class="text-xl sm:text-2xl font-bold text-center">æˆ‘çš„æˆå°±</h2>
                <div class="w-16 sm:w-24"></div>
            </div>
            
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 sm:gap-4">
                <div class="achievement-card bg-light rounded-xl p-3 sm:p-4 text-center card-hover">
                    <div class="text-2xl sm:text-3xl mb-1 sm:mb-2">ğŸ†</div>
                    <div class="font-bold text-sm sm:text-base">åˆçº§ç®—æœ¯ç‹</div>
                    <div class="text-xs sm:text-sm text-secondary">å®Œæˆ10æ¬¡åˆçº§ç»ƒä¹ </div>
                </div>
                <div class="achievement-card bg-light rounded-xl p-3 sm:p-4 text-center card-hover">
                    <div class="text-2xl sm:text-3xl mb-1 sm:mb-2">â­</div>
                    <div class="font-bold text-sm sm:text-base">ä¸­çº§ç®—æœ¯ç‹</div>
                    <div class="text-xs sm:text-sm text-secondary">å®Œæˆ10æ¬¡ä¸­çº§ç»ƒä¹ </div>
                </div>
                <div class="achievement-card bg-light rounded-xl p-3 sm:p-4 text-center card-hover">
                    <div class="text-2xl sm:text-3xl mb-1 sm:mb-2">ğŸ’</div>
                    <div class="font-bold text-sm sm:text-base">é«˜çº§ç®—æœ¯ç‹</div>
                    <div class="text-xs sm:text-sm text-secondary">å®Œæˆ10æ¬¡é«˜çº§ç»ƒä¹ </div>
                </div>
                <div class="achievement-card bg-light rounded-xl p-3 sm:p-4 text-center card-hover">
                    <div class="text-2xl sm:text-3xl mb-1 sm:mb-2">ğŸ”¥</div>
                    <div class="font-bold text-sm sm:text-base">åŠ æ³•å¤§å¸ˆ</div>
                    <div class="text-xs sm:text-sm text-secondary">åŠ æ³•æ­£ç¡®ç‡100%</div>
                </div>
                <div class="achievement-card bg-light rounded-xl p-3 sm:p-4 text-center card-hover">
                    <div class="text-2xl sm:text-3xl mb-1 sm:mb-2">â„ï¸</div>
                    <div class="font-bold text-sm sm:text-base">å‡æ³•å¤§å¸ˆ</div>
                    <div class="text-xs sm:text-sm text-secondary">å‡æ³•æ­£ç¡®ç‡100%</div>
                </div>
            </div>
            
            <div class="mt-6 sm:mt-8 text-center">
                <button id="backFromAchievementsBtn" class="bg-primary text-white px-6 sm:px-8 py-2 sm:py-3 rounded-xl font-bold btn-hover text-sm sm:text-base">
                    è¿”å›é¦–é¡µ
                </button>
            </div>
        </section>

        <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
        <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">å¦‚ä½•ä½¿ç”¨</h3>
                    <button id="closeHelpModal" class="text-2xl">âœ•</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-bold mb-2">1. å¼€å§‹ç»ƒä¹ </h4>
                        <p>ç‚¹å‡»"å¼€å§‹ç»ƒä¹ "æŒ‰é’®ï¼Œè¿›å…¥ç»ƒä¹ è®¾ç½®é¡µé¢ã€‚</p>
                    </div>
                    <div>
                        <h4 class="font-bold mb-2">2. é€‰æ‹©ç»ƒä¹ ç±»å‹</h4>
                        <p>é€‰æ‹©ä½ æƒ³è¦ç»ƒä¹ çš„ç®—æœ¯ç±»å‹ï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•æˆ–é™¤æ³•ã€‚</p>
                    </div>
                    <div>
                        <h4 class="font-bold mb-2">3. é€‰æ‹©éš¾åº¦çº§åˆ«</h4>
                        <p>æ ¹æ®ä½ çš„èƒ½åŠ›é€‰æ‹©éš¾åº¦çº§åˆ«ï¼šåˆçº§ã€ä¸­çº§æˆ–é«˜çº§ã€‚</p>
                    </div>
                    <div>
                        <h4 class="font-bold mb-2">4. å¼€å§‹åšé¢˜</h4>
                        <p>åœ¨æ•°å­—é”®ç›˜ä¸Šè¾“å…¥ç­”æ¡ˆï¼Œç„¶åç‚¹å‡»"æäº¤"æŒ‰é’®ã€‚</p>
                    </div>
                    <div>
                        <h4 class="font-bold mb-2">5. ä½¿ç”¨è¾…åŠ©åŠŸèƒ½</h4>
                        <p>ç‚¹å‡»"å¬é¢˜ç›®"æŒ‰é’®å¯ä»¥å¬åˆ°é¢˜ç›®æœ—è¯»ï¼Œç‚¹å‡»"æç¤º"æŒ‰é’®å¯ä»¥æŸ¥çœ‹è®¡ç®—è¿‡ç¨‹ã€‚</p>
                    </div>
                </div>
                <div class="mt-8 text-center">
                    <button id="gotItBtn" class="bg-primary text-white px-6 py-3 rounded-xl font-bold">
                        æˆ‘çŸ¥é“äº†
                    </button>
                </div>
            </div>
        </div>
    </main>

<script>
    // å…¨å±€å˜é‡
    let currentSettings = { type: 'addition', level: 'easy' };
    let currentQuestion = { num1: 0, num2: 0, operator: '+', answer: 0 };
    let userAnswer = '';
    let questions = [];
    let currentQuestionIndex = 0;
    let correctCount = 0;
    let soundEnabled = true;

    // DOM å…ƒç´ è·å– (ç¡®ä¿ ID å­˜åœ¨)
    const getEl = (id) => document.getElementById(id);
    const elements = {
        welcome: getEl('welcomeSection'),
        settings: getEl('settingsSection'),
        practice: getEl('practiceSection'),
        result: getEl('resultSection'),
        achievements: getEl('achievementsSection'),
        answer: getEl('answer'),
        answerBox: getEl('answerBox'),
        progressBar: getEl('progressBar'),
        progressText: getEl('progressText'),
        num1: getEl('num1'),
        num2: getEl('num2'),
        operator: getEl('operator'),
        helpModal: getEl('helpModal'),
        viz: getEl('calculationVisualization'),
        vizSteps: getEl('visualizationSteps')
    };

    // åˆå§‹åŒ–
    function init() {
        setupEventListeners();
        // é¢„çƒ­è¯­éŸ³ç³»ç»Ÿï¼ˆå®‰å“å…³é”®ï¼‰
        window.speechSynthesis.getVoices();
    }

    // è¯­éŸ³æœ—è¯»æ ¸å¿ƒå‡½æ•° - ä¿®æ­£å®‰å“ä¸å‘å£°é—®é¢˜
    function speakText(text) {
        if (!soundEnabled) return;

        // 1. å…ˆå–æ¶ˆå½“å‰é˜Ÿåˆ—ï¼Œé˜²æ­¢å®‰å“è¯­éŸ³å †ç§¯æŒ‚èµ·
        window.speechSynthesis.cancel();

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-CN';
        utterance.rate = 1.0;
        utterance.pitch = 1.0;

        // 2. å°è¯•è·å–ä¸­æ–‡éŸ³è½¨
        const voices = window.speechSynthesis.getVoices();
        const chineseVoice = voices.find(v => v.lang.includes('zh'));
        if (chineseVoice) utterance.voice = chineseVoice;

        // 3. æ‰§è¡Œæœ—è¯»
        window.speechSynthesis.speak(utterance);
    }

    function setupEventListeners() {
        // å¼€å§‹ç»ƒä¹ æŒ‰é’® - ä¿®æ­£ç‚¹å‡»åä¸æœ—è¯»
        getEl('startPractice').addEventListener('click', () => {
            // åœ¨å®‰å“ä¸Šï¼Œå¿…é¡»åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¶â€œæ¿€æ´»â€è¯­éŸ³ä¸Šä¸‹æ–‡
            speakText(''); 
            elements.welcome.classList.add('hidden');
            elements.settings.classList.remove('hidden');
        });

        // ç¡®è®¤è®¾ç½®å¹¶å¼€å§‹
        getEl('confirmSettings').addEventListener('click', startPractice);

        // æ•°å­—æŒ‰é’®
        document.querySelectorAll('.number-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (userAnswer.length < 3) {
                    userAnswer += btn.textContent.trim();
                    updateAnswerDisplay();
                }
            });
        });

        // æäº¤æŒ‰é’®
        getEl('submitBtn').addEventListener('click', checkAnswer);

        // å…¶ä»–åŠŸèƒ½æŒ‰é’®
        getEl('clearBtn').addEventListener('click', () => { userAnswer = ''; updateAnswerDisplay(); });
        getEl('listenQuestion').addEventListener('click', speakQuestion);
        getEl('showHint').addEventListener('click', showHint);
        getEl('skipQuestion').addEventListener('click', nextQuestion);
        getEl('retryBtn').addEventListener('click', startPractice);

        // å¯¼èˆªè¿”å›æŒ‰é’® (ç»Ÿä¸€å¤„ç†)
        getEl('backToWelcomeFromSettings').onclick = () => switchSection('settings', 'welcome');
        getEl('backToWelcomeFromPractice').onclick = () => switchSection('practice', 'welcome');
        getEl('backToWelcomeBtn').onclick = () => switchSection('result', 'welcome');
        getEl('backFromAchievementsBtn').onclick = () => switchSection('achievements', 'welcome');
        getEl('viewAchievements').onclick = () => switchSection('welcome', 'achievements');

        // è¾…åŠ©åŠŸèƒ½
        getEl('soundToggle').onclick = function() {
            soundEnabled = !soundEnabled;
            this.innerHTML = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        };
        getEl('helpBtn').onclick = () => elements.helpModal.classList.remove('hidden');
        getEl('closeHelpModal').onclick = () => elements.helpModal.classList.add('hidden');
        getEl('gotItBtn').onclick = () => elements.helpModal.classList.add('hidden');
    }

    function switchSection(from, to) {
        elements[from].classList.add('hidden');
        elements[to].classList.remove('hidden');
    }

    function startPractice() {
        switchSection('settings', 'practice');
        currentQuestionIndex = 0;
        correctCount = 0;
        generateQuestions();
        showQuestion();
        updateProgress();
        // å»¶è¿Ÿ 300ms æœ—è¯»ï¼Œç¡®ä¿å®‰å“æµè§ˆå™¨ UI æ¸²æŸ“å®Œæ¯•åå†è¯·æ±‚è¯­éŸ³
        setTimeout(speakQuestion, 300);
    }

    function generateQuestions() {
        questions = [];
        let range = currentSettings.level === 'easy' ? 10 : (currentSettings.level === 'medium' ? 20 : 50);
        for (let i = 0; i < 10; i++) {
            let n1 = Math.floor(Math.random() * range) + 1;
            let n2 = Math.floor(Math.random() * range) + 1;
            if (currentSettings.type === 'subtraction' && n1 < n2) [n1, n2] = [n2, n1];
            let op = currentSettings.type === 'addition' ? '+' : '-';
            questions.push({ num1: n1, num2: n2, operator: op, answer: op === '+' ? n1 + n2 : n1 - n2 });
        }
    }

    function showQuestion() {
        currentQuestion = questions[currentQuestionIndex];
        elements.num1.textContent = currentQuestion.num1;
        elements.operator.textContent = currentQuestion.operator;
        elements.num2.textContent = currentQuestion.num2;
        userAnswer = '';
        updateAnswerDisplay();
        elements.viz.classList.add('hidden');
    }

    function updateAnswerDisplay() {
        elements.answer.textContent = userAnswer || '?';
        elements.answerBox.className = "flex items-center justify-center border-b-4 border-gray-300 min-w-[80px] min-h-[60px]";
    }

    function updateProgress() {
        const pct = (currentQuestionIndex / 10) * 100;
        elements.progressBar.style.width = pct + '%';
        elements.progressText.textContent = `${currentQuestionIndex}/10`;
    }

    function checkAnswer() {
        if (!userAnswer) return;
        if (parseInt(userAnswer) === currentQuestion.answer) {
            correctCount++;
            elements.answerBox.classList.add('bg-green-100');
            speakText('ç­”å¯¹äº†ï¼');
            setTimeout(nextQuestion, 800);
        } else {
            elements.answerBox.classList.add('bg-red-100');
            speakText('å†æƒ³æƒ³çœ‹');
        }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < 10) {
            showQuestion();
            updateProgress();
            setTimeout(speakQuestion, 200);
        } else {
            showResult();
        }
    }

    function showResult() {
        switchSection('practice', 'result');
        const acc = (correctCount / 10) * 100;
        getEl('correctCount').textContent = correctCount;
        getEl('accuracy').textContent = acc + '%';
        getEl('resultTitle').textContent = acc >= 80 ? 'å¤ªæ£’äº†ï¼' : 'ç»§ç»­åŠ æ²¹ï¼';
        speakText(`ç»ƒä¹ ç»“æŸï¼Œä½ çš„æ­£ç¡®ç‡æ˜¯${acc}%`);
    }

    function speakQuestion() {
        const opName = currentQuestion.operator === '+' ? 'åŠ ' : 'å‡';
        speakText(`${currentQuestion.num1} ${opName} ${currentQuestion.num2} ç­‰äºå¤šå°‘ï¼Ÿ`);
    }

    function showHint() {
        elements.viz.classList.remove('hidden');
        elements.vizSteps.innerHTML = `<p class="text-lg">æç¤ºï¼šå¯ä»¥å°è¯•ç”¨æ‰‹æŒ‡ç‚¹æ•°æˆ–è€…å‡‘åæ³•å“¦ï¼ç»“æœæ˜¯ ${currentQuestion.answer}</p>`;
    }

    window.addEventListener('DOMContentLoaded', init);
</script>

    <!-- Footer -->
    <footer class="fixed bottom-0 left-0 right-0 bg-black shadow-md py-8">
        <div class="container mx-auto px-4 text-center text-sm text-white">
            <p>Â© 2026 è¶£å‘³å£ç®—ç»ƒä¹  | ä¸ºå°æœ‹å‹ä»¬è®¾è®¡çš„æ•°å­¦å­¦ä¹ å·¥å…·</p>
        </div>
    </footer>
</body>
</html>
